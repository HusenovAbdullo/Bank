import{_ as X}from"./Button.vue_vue_type_script_setup_true_lang-BEdiinS3.js";import{d as R,c as p,o as m,a as O,u as n,b as V,e as j,f as E,r as v,g as J,h,i as t,t as s,j as d,k as I,F as M,l as S,m as W,w as N,n as w,p as G,_ as g,q as H}from"./index-DrwtuItr.js";import{_ as K}from"./VerticalBarChart.vue_vue_type_script_setup_true_lang-BpOEA0my.js";import{_ as Q,g as x}from"./colors-BjlY6z6C.js";import"./axios-D4YhIzwJ.js";const Z=R({__name:"ReportPieChart",props:{width:{},height:{},data:{}},setup(F){const r=F,b=p(()=>V().colorScheme),C=p(()=>j().darkMode),y=p(()=>({labels:r.data.map(i=>i.label),datasets:[{data:r.data.map(i=>i.percent),backgroundColor:b.value?r.data.map(i=>i.color):"",hoverBackgroundColor:b.value?r.data.map(i=>i.color):"",borderWidth:5,borderColor:C.value?x("darkmode.700"):x("white")}]})),$=p(()=>({maintainAspectRatio:!1,plugins:{legend:{display:!1}}}));return(i,f)=>(m(),O(n(Q),{type:"pie",width:r.width,height:r.height,data:y.value,options:$.value},null,8,["width","height","data","options"]))}}),tt={class:"grid grid-cols-12 gap-6"},et={class:"col-span-12 2xl:col-span-9"},ot={class:"grid grid-cols-12 gap-6"},at={class:"col-span-12 mt-8"},st={class:"flex items-center h-10 intro-y"},lt={class:"mr-5 text-lg font-medium truncate"},nt={class:"grid grid-cols-12 gap-6 mt-5"},rt={class:"relative zoom-in before:box before:absolute before:inset-x-3 before:mt-3 before:h-full before:bg-slate-50 before:content-['']"},it={class:"p-5 box"},ct={class:"flex"},dt={class:"ml-auto"},ut={class:"mt-6 text-3xl font-medium leading-8"},mt={class:"mt-1 text-base text-slate-500"},ht={class:"col-span-12 mt-8 lg:col-span-9"},pt={class:"items-center block h-10 intro-y sm:flex"},ft={class:"mr-5 text-lg font-medium truncate"},_t={class:"p-5 mt-12 intro-y box sm:mt-5"},vt={class:w(["relative","before:content-[''] before:block before:absolute before:w-16 before:left-0 before:top-0 before:bottom-0 before:ml-10 before:mb-7 before:bg-gradient-to-r before:from-white before:via-white/80 before:to-transparent before:dark:from-darkmode-600","after:content-[''] after:block after:absolute after:w-16 after:right-0 after:top-0 after:bottom-0 after:mb-7 after:bg-gradient-to-l after:from-white after:via-white/80 after:to-transparent after:dark:from-darkmode-600"])},gt={class:"col-span-12 mt-8 sm:col-span-6 lg:col-span-3"},bt={class:"flex items-center h-10 intro-y"},xt={class:"mr-5 text-lg font-medium truncate"},yt={href:"",class:"ml-auto truncate text-primary"},kt={class:"p-5 mt-5 intro-y box"},wt={class:"mt-3"},Ct={class:"mx-auto mt-8 w-52 sm:w-auto"},$t={class:"truncate"},Dt={class:"ml-auto font-medium"},It={class:"col-span-12 2xl:col-span-3"},Mt={class:"pb-10 -mb-10 2xl:border-l"},St={class:"grid grid-cols-12 2xl:pl-6 gap-x-6 2xl:gap-x-0 gap-y-6"},Ft={class:"col-span-12 mt-3 md:col-span-6 xl:col-span-4 2xl:col-span-12 xl:col-start-1 xl:row-start-2 2xl:col-start-auto 2xl:row-start-auto"},zt={class:"flex items-center h-10 intro-x"},Tt={class:"mr-5 text-lg font-medium truncate"},qt={class:"mt-5"},Nt={class:"intro-x box mt-5"},Rt={class:"p-5"},At={class:"flex items-center justify-between"},Bt={class:"text-base font-medium"},Ut={class:"grid grid-cols-7 gap-4 mt-5 text-center"},Yt={class:"p-10 box intro-x"},Lt={class:"text-xl font-bold mb-4"},Pt={class:"text-slate-500 mt-2"},Jt=R({__name:"DashboardOverview1",setup(F){const{t:r}=E(),b=p(()=>[{label:r("in_sorting"),percent:parseFloat(u.value.other_items.percent),color:x("primary",.9)},{label:r("completed"),percent:parseFloat(u.value.on_way_items.percent),color:x("pending",.9)},{label:r("returned"),percent:parseFloat(u.value.return.percent),color:x("warning",.9)}]);v("");const C=v();G("bind[importantNotesRef]",e=>{C.value=e});const y=v(null),$=()=>{var e;return(e=y.value)==null?void 0:e.click()},i=async e=>{var l;const o=(l=e.target.files)==null?void 0:l[0];if(o){console.log("Tanlangan fayl:",o.name);try{const k=await o.text();console.log("XML mazmuni:",k);const T=localStorage.getItem("token");if(!T){alert("Token topilmadi. Iltimos, qayta kiring.");return}const D=await fetch("https://treking.uz/mail-items/",{method:"POST",headers:{"Content-Type":"application/xml",Authorization:"Bearer "+T},body:k});if(D.ok)console.log("XML muvaffaqiyatli yuborildi."),alert("Fayl muvaffaqiyatli yuborildi.");else{const q=await D.text();console.error("Serverdan xatolik:",q),alert("Xatolik yuz berdi: "+D.status+`
`+q)}}catch(k){console.error("Yuborishda istisno:",k),alert("XML yuborishda xatolik yuz berdi.")}}},f=new Date,c=v(f.getMonth()),_=v(f.getFullYear()),A=["Yanvar","Fevral","Mart","Aprel","May","Iyun","Iyul","Avgust","Sentyabr","Oktyabr","Noyabr","Dekabr"],B=(e,a)=>new Date(e,a+1,0).getDate(),U=p(()=>new Date(_.value,c.value,1).getDay()),Y=p(()=>{const e=B(_.value,c.value),a=[],o=(U.value+6)%7;for(let l=0;l<o;l++)a.push(null);for(let l=1;l<=e;l++)a.push(l);return a}),L=()=>{c.value===0?(c.value=11,_.value-=1):c.value-=1},P=()=>{c.value===11?(c.value=0,_.value+=1):c.value+=1},u=v({total_items:{count:0,percent:"0%"},other_items:{count:0,percent:"0%"},on_way_items:{count:0,percent:"0%"},return:{count:0,percent:"0%"}}),z=async()=>{const e=localStorage.getItem("token");if(!e){alert("Token topilmadi. Iltimos, qayta kiring."),window.location.href="/login";return}try{const a=await fetch("https://treking.uz/api/mailitem-stats/",{headers:{Authorization:"Bearer "+e}});if(a.status===401){alert("Token muddati tugagan. Iltimos, qayta login qiling."),localStorage.removeItem("token"),window.location.href="/login";return}if(a.ok){const o=await a.json();u.value=o}else console.error("API xatolik:",a.status)}catch(a){console.error("Tarmoq xatoligi:",a)}};return J(()=>{z()}),(e,a)=>(m(),h("div",tt,[t("div",et,[t("div",ot,[t("div",at,[t("div",st,[t("h2",lt,s(e.$t("general_report")),1),t("button",{onClick:z,class:"flex items-center ml-auto text-primary"},[d(n(g),{icon:"RefreshCcw",class:"w-4 h-4 mr-3"}),I(" "+s(e.$t("reload_data")),1)])]),t("div",nt,[(m(!0),h(M,null,S([{label:e.$t("all"),icon:"UsersIcon",data:u.value.total_items},{label:e.$t("in_sorting"),icon:"UserPlusIcon",data:u.value.other_items},{label:e.$t("completed"),icon:"UserCheckIcon",data:u.value.on_way_items},{label:e.$t("returned"),icon:"UserXIcon",data:u.value.return}],(o,l)=>(m(),h("div",{class:"col-span-12 sm:col-span-6 xl:col-span-3 intro-y",key:l},[t("div",rt,[t("div",it,[t("div",ct,[d(n(g),{icon:o.icon,class:"w-[28px] h-[28px] text-primary"},null,8,["icon"]),t("div",dt,[d(n(H),{as:"div",class:"cursor-pointer bg-success py-[3px] flex rounded-full text-white text-xs pl-2 pr-1 items-center font-medium",content:o.data.percent+" oâ€˜zgarish"},{default:N(()=>[I(s(o.data.percent)+" ",1),d(n(g),{icon:"ChevronUp",class:"w-4 h-4 ml-0.5"})]),_:2},1032,["content"])])]),t("div",ut,s(o.data.count),1),t("div",mt,s(o.label),1)])])]))),128))])]),t("div",ht,[t("div",pt,[t("h2",ft,s(e.$t("monthly_report")),1)]),t("div",_t,[t("div",vt,[d(n(K),{height:400})])])]),t("div",gt,[t("div",bt,[t("h2",xt,s(e.$t("report")),1),t("a",yt,s(e.$t("refresh")),1)]),t("div",kt,[t("div",wt,[d(n(Z),{height:213,data:b.value},null,8,["data"])]),t("div",Ct,[(m(!0),h(M,null,S(b.value,(o,l)=>(m(),h("div",{key:l,class:w(["flex items-center mt-4",{"mt-0":l===0}])},[t("div",{class:w(["w-2 h-2 mr-3 rounded-full",o.color])},null,2),t("span",$t,s(o.label),1),t("span",Dt,s(o.percent),1)],2))),128))])])])])]),t("div",It,[t("div",Mt,[t("div",St,[t("div",Ft,[t("div",zt,[t("h2",Tt,s(e.$t("calendar")),1)]),t("div",qt,[t("div",Nt,[t("div",Rt,[t("div",At,[t("button",{onClick:L},[d(n(g),{icon:"ChevronLeft",class:"w-5 h-5 text-slate-500"})]),t("div",Bt,s(A[c.value])+" "+s(_.value),1),t("button",{onClick:P},[d(n(g),{icon:"ChevronRight",class:"w-5 h-5 text-slate-500"})])]),t("div",Ut,[a[0]||(a[0]=W('<div class="font-medium">Du</div><div class="font-medium">Se</div><div class="font-medium">Cho</div><div class="font-medium">Pa</div><div class="font-medium">Ju</div><div class="font-medium">Sha</div><div class="font-medium">Ya</div>',7)),(m(!0),h(M,null,S(Y.value,(o,l)=>(m(),h("div",{key:l,class:w(["py-0.5 rounded relative",{"text-slate-400":o===null,"bg-primary text-white":o===n(f).getDate()&&c.value===n(f).getMonth()&&_.value===n(f).getFullYear()}])},s(o??""),3))),128))])])])]),a[1]||(a[1]=t("br",null,null,-1)),t("div",Yt,[t("h2",Lt,s(e.$t("xml_upload")),1),d(n(X),{variant:"primary",class:"mb-4",onClick:$},{default:N(()=>[d(n(g),{icon:"Upload",class:"w-4 h-4 mr-2"}),I(" "+s(e.$t("upload_file")),1)]),_:1}),t("input",{ref_key:"fileInputRef",ref:y,type:"file",class:"hidden",accept:".xml",onChange:i},null,544),t("p",Pt,s(e.$t("xml_description")),1)])])])])])]))}});export{Jt as default};
