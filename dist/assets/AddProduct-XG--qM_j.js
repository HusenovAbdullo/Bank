import{d as ae,f as oe,r as c,A as q,g as se,z as ne,h as v,i as a,t as f,j as d,u,w as b,B as le,C as ie,F as B,l as re,D as P,k as m,o as p,v as ce,_ as de,E as ue}from"./index-BkxZ8ppa.js";import{T as me,c as ge,x as he,i as ve}from"./xlsx-DAllgAbK.js";import{_ as k}from"./Button.vue_vue_type_script_setup_true_lang-B_0nlnlX.js";import{a as N}from"./axios-D4YhIzwJ.js";const fe={class:"intro-y box p-5 mt-5"},pe={class:"flex items-center justify-between"},_e={class:"text-lg font-medium"},be={class:"mt-5 flex gap-2 flex-wrap items-center"},ke=["value"],we={class:"overflow-x-auto scrollbar-hidden mt-5"},xe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},ye={class:"bg-white p-4 rounded shadow-lg relative"},Ce={class:"flex justify-between"},ze=["disabled"],Se={key:1,class:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-600 text-white px-6 py-3 rounded shadow-lg z-[100]"},Pe={key:2,class:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-red-600 text-white px-6 py-3 rounded shadow-lg z-[100]"},De={key:3,class:"fixed inset-0 z-[100] bg-black bg-opacity-60 flex items-center justify-center"},Ae={class:"bg-white rounded-lg shadow-xl p-6 w-[90%] max-w-md relative"},Te={key:0,class:"mt-4"},je=["src"],Ee={key:1,class:"mt-4 text-gray-500 italic"},qe=ae({__name:"AddProduct",setup(Ie){const{t:g}=oe(),D=c(),r=c(),y=q({barcode:""}),_=c(10),A=c(!1);let z=null,S=null;const I=c(""),T=c(!1),w=e=>{I.value=e,T.value=!0,setTimeout(()=>T.value=!1,3e3)},j=c(!1),h=q({name:"",time:"",image:""}),V=e=>{h.name=e.checked_name||"Noma'lum",h.time=e.checked_time?new Date(e.checked_time).toLocaleString():"Noma'lum",e.checked_image?h.image=e.checked_image.startsWith("http")?e.checked_image:`https://bank1.pochta.uz${e.checked_image}`:h.image="",j.value=!0},U=()=>{j.value=!1},M=c(""),E=c(!1),F=e=>{M.value=e,E.value=!0,setTimeout(()=>E.value=!1,3e3)},C=c(!1),X=async e=>{z=e,A.value=!0,await ue();try{const t=document.getElementById("cameraPreview");S=await navigator.mediaDevices.getUserMedia({video:!0}),t.srcObject=S}catch(t){w("Kamera ochilmadi: "+t.message),console.error("Kamera xatosi:",t)}},$=()=>{const e=document.getElementById("cameraPreview");S&&S.getTracks().forEach(t=>t.stop()),e.srcObject=null,A.value=!1,z=null,C.value=!1},J=async()=>{var l,o,L,R;if(C.value)return;C.value=!0;const e=document.getElementById("cameraPreview"),t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;const s=t.getContext("2d");s==null||s.drawImage(e,0,0);const i=t.toDataURL("image/jpeg"),n=localStorage.getItem("token");if(!n){w("Token topilmadi."),C.value=!1;return}try{const x=await N.post("https://bank1.pochta.uz/api/v1/face-recognition/",{photo:i},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if((l=x.data)!=null&&l.token&&((o=x.data)!=null&&o.phone_number)){const{phone_number:te}=x.data;await N.post("https://bank1.pochta.uz/api/v1/check-mail/",{id:z.id,phone_number:te,barcode:z.barcode,checked_image:i},{headers:{Authorization:`Bearer ${n}`}}),F("Jo'natma tasdiqlandi!"),(L=r.value)==null||L.setPage(1)}else w("Jo'natma tasdiqlanmadi. Yuz aniqlanmadi.")}catch(x){console.error(x),((R=x.response)==null?void 0:R.status)===400?w("Jo'natma tasdiqlanmadi. Rasm noto‘g‘ri yoki aniqlanmadi."):w("Xatolik yuz berdi!")}finally{$()}},H=async()=>{const e=localStorage.getItem("token");if(!e){w("Token topilmadi. Iltimos, tizimga kiring.");return}D.value&&(r.value=new me(D.value,{ajaxURL:"https://bank1.pochta.uz/api/v1/mails-all/",ajaxConfig:{method:"GET",headers:{Authorization:`Bearer ${e}`}},ajaxResponse:(t,s,i)=>{const n=localStorage.getItem("phone");console.log(n);let l=[];return Array.isArray(i)?l=i:Array.isArray(i.results)&&(l=i.results),n!=="123"&&(l=l.filter(o=>o.is_check===!1)),{data:l.map(o=>({id:o.id,barcode:o.barcode,weight:o.weight,sent_date:o.send_date?new Date(o.send_date).toLocaleDateString():"-",received_date:o.received_date?new Date(o.received_date).toLocaleDateString():"-",last_event_date:o.last_event_date?new Date(o.last_event_date).toLocaleDateString():"-",city:o.city||"-",is_check:o.is_check,checked_name:o.checked_name,checked_time:o.checked_time,checked_image:o.checked_image})),last_page:Math.ceil(l.length/_.value)}},layout:"fitColumns",pagination:!0,paginationSize:_.value,paginationMode:"remote",placeholder:"No matching records found",columns:(()=>{const t=localStorage.getItem("phone"),s=[{title:g("barcode"),field:"barcode",hozAlign:"center"},{title:g("weight"),field:"weight",hozAlign:"center"},{title:g("sent_date"),field:"sent_date",hozAlign:"center"},{title:g("received_date"),field:"received_date",hozAlign:"center"},{title:g("last_event_date"),field:"last_event_date",hozAlign:"center"},{title:g("city"),field:"city",hozAlign:"center"}];return t==="123"?[...s,{title:"Holati",field:"is_check",hozAlign:"center",formatter:i=>i.getData().is_check?"<button class='checked-info-btn bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-4 rounded-full text-xs'>Tasdiqlangan</button>":"<span class='text-red-600 font-semibold'>Tasdiqlanmagan</span>",cellClick:(i,n)=>{const l=n.getData();l.is_check&&(V(l),console.log(l))}}]:[...s,{title:g("approve"),formatter:()=>`<button class='approve-btn bg-blue-800 hover:bg-blue-700 text-white font-bold py-1 px-4 rounded-full text-xs'>${g("approve")}</button>`,width:130,hozAlign:"center",cellClick:async function(i,n){const l=n.getData();await X(l)}}]})(),ajaxURLGenerator:(t,s,i)=>{const n=new URLSearchParams;return n.set("page",i.page),n.set("page_size",_.value.toString()),y.barcode&&n.set("barcode",y.barcode),`${t}?${n.toString()}`}}),r.value.on("renderComplete",()=>{ge({icons:ve,attrs:{"stroke-width":1.5},nameAttr:"data-lucide"})}))},O=()=>{var e;return(e=r.value)==null?void 0:e.setPage(1)},G=()=>{var e;y.barcode="",(e=r.value)==null||e.setPage(1)},K=()=>{var e;return(e=r.value)==null?void 0:e.setPageSize(_.value)};se(()=>{H(),window.addEventListener("resize",()=>{var e;return(e=r.value)==null?void 0:e.redraw()})}),ne(_,()=>K());const W=()=>{var e;return(e=r.value)==null?void 0:e.download("csv","data.csv")},Y=()=>{var e;return(e=r.value)==null?void 0:e.download("json","data.json")},Q=()=>{var e;window.XLSX=he,(e=r.value)==null||e.download("xlsx","data.xlsx",{sheetName:"Data"})},Z=()=>{var e;return(e=r.value)==null?void 0:e.download("html","data.html",{style:!0})},ee=()=>{var e;return(e=r.value)==null?void 0:e.print()};return(e,t)=>(p(),v(B,null,[a("div",fe,[a("div",pe,[a("h2",_e,f(e.$t("statuses_statistics")),1)]),a("div",be,[d(u(ce),{modelValue:y.barcode,"onUpdate:modelValue":t[0]||(t[0]=s=>y.barcode=s),style:{width:"250px"},placeholder:e.$t("search_barcode")},null,8,["modelValue","placeholder"]),d(u(k),{onClick:O},{default:b(()=>[m(f(e.$t("go")),1)]),_:1}),d(u(k),{variant:"secondary",onClick:G},{default:b(()=>[m(f(e.$t("reset")),1)]),_:1}),d(u(k),{variant:"outline-secondary",onClick:ee},{default:b(()=>[d(u(de),{icon:"Printer",class:"w-4 h-4 mr-2"}),t[2]||(t[2]=m(" Print "))]),_:1}),d(u(k),{variant:"outline-secondary",onClick:W},{default:b(()=>t[3]||(t[3]=[m("CSV")])),_:1}),d(u(k),{variant:"outline-secondary",onClick:Y},{default:b(()=>t[4]||(t[4]=[m("JSON")])),_:1}),d(u(k),{variant:"outline-secondary",onClick:Q},{default:b(()=>t[5]||(t[5]=[m("XLSX")])),_:1}),d(u(k),{variant:"outline-secondary",onClick:Z},{default:b(()=>t[6]||(t[6]=[m("HTML")])),_:1}),le(a("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>_.value=s),class:"form-select ml-auto w-20"},[(p(),v(B,null,re([10,20,50,100],s=>a("option",{key:s,value:s},f(s),9,ke)),64))],512),[[ie,_.value]])]),a("div",we,[a("div",{ref_key:"tableRef",ref:D},null,512)])]),A.value?(p(),v("div",xe,[a("div",ye,[t[7]||(t[7]=a("video",{id:"cameraPreview",autoplay:"",playsinline:"",class:"mb-4 w-80 h-60 bg-gray-200 rounded"},null,-1)),a("div",Ce,[a("button",{onClick:J,disabled:C.value,style:{color:"#ffff"},class:"bg-green-600 text-white px-4 py-2 rounded mr-2"}," Rasmga olish ",8,ze),a("button",{onClick:$,class:"bg-gray-400 text-white px-4 py-2 rounded"},"Bekor qilish")])])])):P("",!0),E.value?(p(),v("div",Se,f(M.value),1)):P("",!0),T.value?(p(),v("div",Pe,f(I.value),1)):P("",!0),j.value?(p(),v("div",De,[a("div",Ae,[a("button",{onClick:U,class:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-xl"},"×"),t[10]||(t[10]=a("h3",{class:"text-lg font-semibold text-green-700 mb-4"},"Tasdiqlovchi Ma'lumotlar",-1)),a("p",null,[t[8]||(t[8]=a("strong",null,"F.I.Sh:",-1)),m(" "+f(h.name),1)]),a("p",null,[t[9]||(t[9]=a("strong",null,"Vaqti:",-1)),m(" "+f(h.time),1)]),h.image?(p(),v("div",Te,[a("img",{src:h.image,alt:"Tasdiqlangan rasm",class:"rounded shadow border w-full object-cover max-h-60"},null,8,je)])):(p(),v("div",Ee,"Rasm mavjud emas"))])])):P("",!0)],64))}});export{qe as default};
