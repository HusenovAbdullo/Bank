import{d as se,f as ne,r as d,A as N,g as V,z as le,h as c,i as a,t as p,j as m,u as g,w as k,B as ie,C as re,F as U,l as de,D as j,k as h,o as u,v as ce,_ as ue,E as me}from"./index-Tdtmmhim.js";import{T as ge,c as he,x as ve,i as fe}from"./xlsx-DAllgAbK.js";import{_ as b}from"./Button.vue_vue_type_script_setup_true_lang-DdNVJ4XG.js";import{a as F}from"./axios-D4YhIzwJ.js";const pe={key:0},_e={class:"intro-y box p-5 mt-5"},ke={class:"flex items-center justify-between"},be={class:"text-lg font-medium"},we={class:"mt-5 flex gap-2 flex-wrap items-center"},xe=["value"],ye={class:"overflow-x-auto scrollbar-hidden mt-5"},Ce={key:1,class:"text-center mt-20 text-red-600 font-semibold text-lg"},ze={key:2,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Se={class:"bg-white p-4 rounded shadow-lg relative"},Pe={class:"flex justify-between"},je=["disabled"],De={key:3,class:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-600 text-white px-6 py-3 rounded shadow-lg z-[100]"},Te={key:4,class:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-red-600 text-white px-6 py-3 rounded shadow-lg z-[100]"},Ae={key:5,class:"fixed inset-0 z-[100] bg-black bg-opacity-60 flex items-center justify-center"},Ee={class:"bg-white rounded-lg shadow-xl p-6 w-[90%] max-w-md relative"},Ie={key:0,class:"mt-4"},Le=["src"],Me={key:1,class:"mt-4 text-gray-500 italic"},Ve=se({__name:"Categories",setup($e){const{t:v}=ne(),D=d(),i=d(),y=N({barcode:""}),_=d(10),T=d(!1);let S=null,P=null;const M=d(""),A=d(!1),w=e=>{M.value=e,A.value=!0,setTimeout(()=>A.value=!1,3e3)},E=d(!1),f=N({name:"",time:"",image:""}),J=e=>{f.name=e.checked_name||"Noma'lum",f.time=e.checked_time?new Date(e.checked_time).toLocaleString():"Noma'lum",e.checked_image?f.image=e.checked_image.startsWith("http")?e.checked_image:`https://bank1.pochta.uz${e.checked_image}`:f.image="",E.value=!0},X=()=>{E.value=!1},$=d(""),I=d(!1),H=e=>{$.value=e,I.value=!0,setTimeout(()=>I.value=!1,3e3)},C=d(!1),W=async e=>{S=e,T.value=!0,await me();try{const t=document.getElementById("cameraPreview");P=await navigator.mediaDevices.getUserMedia({video:!0}),t.srcObject=P}catch(t){w("Kamera ochilmadi: "+t.message),console.error("Kamera xatosi:",t)}},q=()=>{const e=document.getElementById("cameraPreview");P&&P.getTracks().forEach(t=>t.stop()),e.srcObject=null,T.value=!1,S=null,C.value=!1},O=async()=>{var l,o,B,R;if(C.value)return;C.value=!0;const e=document.getElementById("cameraPreview"),t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;const s=t.getContext("2d");s==null||s.drawImage(e,0,0);const r=t.toDataURL("image/jpeg"),n=localStorage.getItem("token");if(!n){w("Token topilmadi."),C.value=!1;return}try{const x=await F.post("https://bank1.pochta.uz/api/v1/face-recognition/",{photo:r},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if((l=x.data)!=null&&l.token&&((o=x.data)!=null&&o.phone_number)){const{phone_number:oe}=x.data;await F.post("https://bank1.pochta.uz/api/v1/check-mail/",{id:S.id,phone_number:oe,barcode:S.barcode,checked_image:r},{headers:{Authorization:`Bearer ${n}`}}),H("Jo'natma tasdiqlandi!"),(B=i.value)==null||B.setPage(1)}else w("Jo'natma tasdiqlanmadi. Yuz aniqlanmadi.")}catch(x){console.error(x),((R=x.response)==null?void 0:R.status)===400?w("Jo'natma tasdiqlanmadi. Rasm noto‘g‘ri yoki aniqlanmadi."):w("Xatolik yuz berdi! Bu jo'natma sizga tegishli emas")}finally{q()}},L=async()=>{const e=localStorage.getItem("token");if(!e){w("Token topilmadi. Iltimos, tizimga kiring.");return}D.value&&(i.value=new ge(D.value,{ajaxURL:"https://bank1.pochta.uz/api/v1/mails-all/",ajaxConfig:{method:"GET",headers:{Authorization:`Bearer ${e}`}},ajaxResponse:(t,s,r)=>{const n=localStorage.getItem("phone");console.log(n);let l=[];return Array.isArray(r)?l=r:Array.isArray(r.results)&&(l=r.results),n!=="123"&&(l=l.filter(o=>o.is_check===!1)),{data:l.map(o=>({id:o.id,barcode:o.barcode,weight:o.weight,sent_date:o.send_date?new Date(o.send_date).toLocaleDateString():"-",received_date:o.received_date?new Date(o.received_date).toLocaleDateString():"-",last_event_date:o.last_event_date?new Date(o.last_event_date).toLocaleDateString():"-",city:o.city||"-",is_check:o.is_check,checked_name:o.checked_name,checked_time:o.checked_time,checked_image:o.checked_image})),last_page:Math.ceil(l.length/_.value)}},layout:"fitColumns",pagination:!0,paginationSize:_.value,paginationMode:"remote",placeholder:"No matching records found",columns:(()=>{const t=localStorage.getItem("phone"),s=[{title:v("barcode"),field:"barcode",hozAlign:"center"},{title:v("weight"),field:"weight",hozAlign:"center"},{title:v("sent_date"),field:"sent_date",hozAlign:"center"},{title:v("received_date"),field:"received_date",hozAlign:"center"},{title:v("last_event_date"),field:"last_event_date",hozAlign:"center"},{title:v("city"),field:"city",hozAlign:"center"}];return t==="123"?[...s,{title:"Holati",field:"is_check",hozAlign:"center",formatter:r=>r.getData().is_check?"<button class='checked-info-btn bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-4 rounded-full text-xs'>Tasdiqlangan</button>":"<span class='text-red-600 font-semibold'>Tasdiqlanmagan</span>",cellClick:(r,n)=>{const l=n.getData();l.is_check&&(J(l),console.log(l))}}]:[...s,{title:v("approve"),formatter:()=>`<button class='approve-btn bg-blue-800 hover:bg-blue-700 text-white font-bold py-1 px-4 rounded-full text-xs'>${v("approve")}</button>`,width:130,hozAlign:"center",cellClick:async function(r,n){const l=n.getData();await W(l)}}]})(),ajaxURLGenerator:(t,s,r)=>{const n=new URLSearchParams;return n.set("page",r.page),n.set("page_size",_.value.toString()),y.barcode&&n.set("barcode",y.barcode),`${t}?${n.toString()}`}}),i.value.on("renderComplete",()=>{he({icons:fe,attrs:{"stroke-width":1.5},nameAttr:"data-lucide"})}))},z=d(!1);V(()=>{z.value=window.innerWidth<800,window.addEventListener("resize",()=>{z.value=window.innerWidth<800,!z.value&&!i.value&&L()}),z.value||L()});const G=()=>{var e;return(e=i.value)==null?void 0:e.setPage(1)},K=()=>{var e;y.barcode="",(e=i.value)==null||e.setPage(1)},Y=()=>{var e;return(e=i.value)==null?void 0:e.setPageSize(_.value)};V(()=>{L(),window.addEventListener("resize",()=>{var e;return(e=i.value)==null?void 0:e.redraw()})}),le(_,()=>Y());const Q=()=>{var e;return(e=i.value)==null?void 0:e.download("csv","data.csv")},Z=()=>{var e;return(e=i.value)==null?void 0:e.download("json","data.json")},ee=()=>{var e;window.XLSX=ve,(e=i.value)==null||e.download("xlsx","data.xlsx",{sheetName:"Data"})},te=()=>{var e;return(e=i.value)==null?void 0:e.download("html","data.html",{style:!0})},ae=()=>{var e;return(e=i.value)==null?void 0:e.print()};return(e,t)=>(u(),c(U,null,[z.value?(u(),c("div",Ce," Jadval faqat katta ekranlarda mavjud. Iltimos, kompyuterdan foydalaning. ")):(u(),c("div",pe,[a("div",_e,[a("div",ke,[a("h2",be,p(e.$t("statuses_statistics")),1)]),a("div",we,[m(g(ce),{modelValue:y.barcode,"onUpdate:modelValue":t[0]||(t[0]=s=>y.barcode=s),style:{width:"250px"},placeholder:e.$t("search_barcode")},null,8,["modelValue","placeholder"]),m(g(b),{onClick:G},{default:k(()=>[h(p(e.$t("go")),1)]),_:1}),m(g(b),{variant:"secondary",onClick:K},{default:k(()=>[h(p(e.$t("reset")),1)]),_:1}),m(g(b),{variant:"outline-secondary",onClick:ae},{default:k(()=>[m(g(ue),{icon:"Printer",class:"w-4 h-4 mr-2"}),t[2]||(t[2]=h(" Print "))]),_:1}),m(g(b),{variant:"outline-secondary",onClick:Q},{default:k(()=>t[3]||(t[3]=[h("CSV")])),_:1}),m(g(b),{variant:"outline-secondary",onClick:Z},{default:k(()=>t[4]||(t[4]=[h("JSON")])),_:1}),m(g(b),{variant:"outline-secondary",onClick:ee},{default:k(()=>t[5]||(t[5]=[h("XLSX")])),_:1}),m(g(b),{variant:"outline-secondary",onClick:te},{default:k(()=>t[6]||(t[6]=[h("HTML")])),_:1}),ie(a("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>_.value=s),class:"form-select ml-auto w-20"},[(u(),c(U,null,de([10,20,50,100],s=>a("option",{key:s,value:s},p(s),9,xe)),64))],512),[[re,_.value]])]),a("div",ye,[a("div",{ref_key:"tableRef",ref:D},null,512)])])])),T.value?(u(),c("div",ze,[a("div",Se,[t[7]||(t[7]=a("video",{id:"cameraPreview",autoplay:"",playsinline:"",class:"mb-4 w-80 h-60 bg-gray-200 rounded"},null,-1)),a("div",Pe,[a("button",{onClick:O,disabled:C.value,class:"bg-green-600 text-white px-4 py-2 rounded mr-2"}," Rasmga olish ",8,je),a("button",{onClick:q,class:"bg-gray-400 text-white px-4 py-2 rounded"},"Bekor qilish")])])])):j("",!0),I.value?(u(),c("div",De,p($.value),1)):j("",!0),A.value?(u(),c("div",Te,p(M.value),1)):j("",!0),E.value?(u(),c("div",Ae,[a("div",Ee,[a("button",{onClick:X,class:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-xl"},"×"),t[10]||(t[10]=a("h3",{class:"text-lg font-semibold text-green-700 mb-4"},"Tasdiqlovchi ma'lumotlari",-1)),a("p",null,[t[8]||(t[8]=a("strong",null,"F.I.Sh:",-1)),h(" "+p(f.name),1)]),a("p",null,[t[9]||(t[9]=a("strong",null,"Vaqti:",-1)),h(" "+p(f.time),1)]),f.image?(u(),c("div",Ie,[a("img",{src:f.image,alt:"Tasdiqlangan rasm",class:"rounded shadow border w-full object-cover max-h-60"},null,8,Le)])):(u(),c("div",Me,"Rasm mavjud emas"))])])):j("",!0)],64))}});export{Ve as default};
